<dom-module id="date-picker-presentation-demos">
  <template>
    <style include="vaadin-component-demo-shared-styles">
      :host {
        display: block;
      }
    </style>

    <h3>Date range</h3>
    <vaadin-demo-snippet id="date-picker-date-range" when-defined="vaadin-date-picker">
      <template preserve-content>
        <vaadin-date-picker id="start" label="From date" can-be-fuzzy></vaadin-date-picker>
        <vaadin-date-picker id="end" label="To date" can-be-fuzzy></vaadin-date-picker>

        <p>Selected range: <span></span></p>
        <script>
          const i18n = {
            monthNames: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'],
            weekdays: ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'],
            weekdaysShort: ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'],
            firstDayOfWeek: 0,
            week: 'Semaine',
            calendar: 'Calendrier',
            clear: 'Effacer',
            today: 'Aujourd\'hui',
            thisMonth: 'mois courant',
            thisYear: new Date().getFullYear(),
            cancel: 'Annuler',
            formatDate: (d, acc) => {
              const yearStr = String(d.year).replace(/\d+/, y => '0000'.substr(y.length) + y);
              const tab = [yearStr];
              acc !== 'year' && tab.unshift((d.month + 1));
              acc === 'day' && tab.unshift(d.day);
              return tab.join('/');
            },
            parseDate: text => {
              const parts = text.split('/');
              let day, month, year;

              if (parts.length === 3) {
                year = parts[2];
                month = parts[1];
                day = parts[0];
              } else if (parts.length === 2) {
                year = parts[1];
                month = parts[0];
                day = '1';
              } else if (parts.length === 1) {
                year = parts[0];
                day = '1';
                month = '1';
              }

              if (day !== undefined) {
                return {day, month, year};
              }
            },
            formatTitle: (monthName, fullYear) => {
    return fullYear;
  }
          };

          window.addDemoReadyListener('#date-picker-date-range', function(document) {
            const start = document.querySelector('#start');
            const end = document.querySelector('#end');
            const span = document.querySelector('span');

            start.i18n = i18n;
            end.i18n = i18n;
            // start.canBeFuzzy=true;
            // end.canBeFuzzy=true;

            start.addEventListener('change', function(event) {
              end.min = event.target.value;

              // Open the second date picker when the user has selected a value
              if (start.value) {
                end.open();
              }
            });

            end.addEventListener('change', function(event) {
              start.max = event.target.value;
            });

            start.addEventListener('change', function(event) {
              span.textContent = event.target.value.trim() + ' - ' + end.value.trim();
            });

            end.addEventListener('change', function(event) {
              span.textContent = start.value.trim() + ' - ' + event.target.value.trim();
            });
          });
        </script>
      </template>
    </vaadin-demo-snippet>

    <h3>Date picker with week numbers</h3>
    <p>Week numbers are only supported for locales that start the week on Monday.</p>
    <vaadin-demo-snippet id="date-picker-with-week-numbers" when-defined="vaadin-date-picker">
      <template preserve-content>
        <vaadin-date-picker show-week-numbers label="Label"></vaadin-date-picker>
        <script>
          window.addDemoReadyListener('#date-picker-with-week-numbers', function(document) {
            const datepicker = document.querySelector('vaadin-date-picker');
            datepicker.set('i18n.firstDayOfWeek', 1);
          });
        </script>
      </template>
    </vaadin-demo-snippet>

  </template>
  <script type="module">
import { PolymerElement } from '@polymer/polymer/polymer-element.js';
class DatePickerPresentationDemos extends DemoReadyEventEmitter(DatePickerDemo(PolymerElement)) {
  static get is() {
    return 'date-picker-presentation-demos';
  }

  static get properties() {
    return {
      i18n: {
        type: Object,
        value: {
          monthNames: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin',
            'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'],
          weekdays: ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'],
          weekdaysShort: ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'],
          firstDayOfWeek: 0,
          week: 'Semaine',
          calendar: 'Calendrier',
          clear: 'Effacer',
          today: 'Aujourd\'hui',
          cancel: 'Annuler',
          formatDate: d => {
            const yearStr = String(d.year).replace(/\d+/, y => '0000'.substr(y.length) + y);
            return [d.day, d.month + 1, yearStr].join('/');
          },
          parseDate: text => {
            const parts = text.split('/');
            const today = new Date();
            let date, month = today.getMonth(), year = today.getFullYear();

            if (parts.length === 3) {
              year = parseInt(parts[2]);
              if (parts[2].length < 3 && year >= 0) {
                year += year < 30 ? 2000 : 1900;
              }
              month = parseInt(parts[0]) - 1;
              date = parseInt(parts[1]);
            } else if (parts.length === 2) {
              month = parseInt(parts[0]) - 1;
              date = parseInt(parts[1]);
            } else if (parts.length === 1) {
              date = parseInt(parts[0]);
            }

            if (date !== undefined) {
              return {day: date, month, year};
            }
          },
          formatTitle: (monthName, fullYear) => {
            return fullYear;
          }
        }
      }
    };

  }
}
customElements.define(DatePickerPresentationDemos.is, DatePickerPresentationDemos);
</script>
</dom-module>
